<?xml version="1.0" encoding="UTF-8"?>
<ui:composition xmlns="http://www.w3.org/1999/xhtml"
                xmlns:ui="jakarta.faces.facelets"
                xmlns:h="jakarta.faces.html"
                xmlns:f="jakarta.faces.core"
                template="/template/main.xhtml">

    <ui:define name="head">
        <h:outputStylesheet library="css" name="main.css"/>
        <h:outputStylesheet library="css" name="form.css"/>
    </ui:define>

    <ui:define name="content">
        <h:form id="userForm" styleClass="form-container" prependId="false">
            <h2>Add New User</h2>

            <!-- Username -->
            <div class="form-group mb-3">
                <h:outputLabel for="username" value="Username:"/>
                <h:inputText id="username" value="#{userCreateView.user.username}"
                             required="true" requiredMessage="Username is required"
                             styleClass="form-control"/>
                <h:message for="username" styleClass="text-danger"/>
            </div>

            <!-- Registration date -->
            <div class="form-group mb-3">
                <h:outputLabel for="registrationDate" value="Registration Date:"/>
                <h:inputText id="registrationDate" value="#{userCreateView.user.registrationDate}"
                             required="true" requiredMessage="Registration date is required"
                             styleClass="form-control">
                </h:inputText>
                <h:message for="registrationDate" styleClass="text-danger"/>
            </div>

            <!-- Movies Section -->
            <div class="movies-section mt-4">
                <h3>Owned Movies</h3>

                <!-- Current Movies List -->
                <div id="movieList" class="mb-4">
                    <h:dataTable value="#{userCreateView.user.ownedMovies}" var="movie"
                                 styleClass="table table-striped"
                                 rendered="#{not empty userCreateView.user.ownedMovies}">
                        <h:column>
                            <f:facet name="header">Title</f:facet>
                            #{movie.title}
                        </h:column>
                        <h:column>
                            <f:facet name="header">Release Date</f:facet>
                            <h:outputText value="#{movie.releaseDate}">
                            </h:outputText>
                        </h:column>
                        <h:column>
                            <f:facet name="header">Actions</f:facet>
                            <h:commandButton value="Remove"
                                             action="#{userCreateView.removeMovie(movie)}"
                                             styleClass="btn btn-danger btn-sm">
                                <f:ajax execute="@this" render="movieList"/>
                            </h:commandButton>
                        </h:column>
                    </h:dataTable>

                    <h:outputLabel class="alert alert-info" rendered="#{empty userCreateView.user.ownedMovies}">
                        No movies added yet.
                    </h:outputLabel>
                </div>

                <!-- Add Movie Form - Simple and Always Visible -->
                <div class="add-movie-form border p-3 rounded bg-light">
                    <h4>Add New Movie</h4>

                    <div class="row">
                        <div class="col-md-6">
                            <div class="form-group mb-3">
                                <h:outputLabel for="movieTitle" value="Movie Title:"/>
                                <h:inputText id="movieTitle" value="#{userCreateView.newMovie.title}"
                                             required="true" requiredMessage="Movie title is required"
                                             styleClass="form-control"/>
                                <h:message for="movieTitle" styleClass="text-danger"/>
                            </div>
                        </div>

                        <div class="col-md-6">
                            <div class="form-group mb-3">
                                <h:outputLabel for="movieReleaseDate" value="Release Date:"/>
                                <h:inputText id="movieReleaseDate" value="#{userCreateView.newMovie.releaseDate}"
                                             required="true" requiredMessage="Release date is required"
                                             styleClass="form-control">
                                </h:inputText>
                                <h:message for="movieReleaseDate" styleClass="text-danger"/>
                            </div>
                        </div>
                    </div>

                    <h:commandButton id="addMovieBtn" value="Add Movie"
                                     action="#{userCreateView.addMovie}"
                                     styleClass="btn btn-primary">
                        <f:ajax execute="movieTitle movieReleaseDate"
                                render="movieList movieTitle movieReleaseDate"/>
                    </h:commandButton>
                </div>
            </div>

            <!-- Buttons -->
            <div class="mt-4">
                <h:commandButton value="Add User"
                                 action="#{userCreateView.save}"
                                 styleClass="btn btn-success"/>
                <h:link value="Cancel"
                        outcome="/view/user/user_list.xhtml?faces-redirect=true"
                        styleClass="btn btn-secondary ms-2"/>
            </div>
        </h:form>
    </ui:define>
</ui:composition>